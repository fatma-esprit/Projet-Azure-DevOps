trigger:
- main

pool:
  name: Default  # Ton agent auto-hébergé

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '12.x'  # Utilisation de Node.js 12 compatible avec Angular 6
  displayName: 'Installer Node.js 12'

- script: |
    rm -rf package-lock.json node_modules
    npm cache clean --force
    npm install --legacy-peer-deps
    npm rebuild node-sass
  workingDirectory: $(Build.SourcesDirectory)
  displayName: 'Installer les dépendances'

- script: |
    npm install -g @angular/cli@6.0.8 --force  # Installation de Angular CLI sans erreur
  displayName: 'Installer Angular CLI'

- script: |
    ng build --configuration production  # Exécution avec Angular CLI
  workingDirectory: $(Build.SourcesDirectory)
  displayName: 'Construire l’application Angular'

- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: '$(Build.SourcesDirectory)/dist'
    artifactName: 'drop'
  displayName: 'Publier les artefacts de build'
